Start up MongoDB process :
# .conf files are supplied in course
mongod -f ~/university/m040/shared/rs1_linux.conf
mongod -f ~/university/m040/shared/rs2_linux.conf
mongod -f ~/university/m040/shared/rs3_linux.conf

Initiate the Replica Set :
mongo --eval 'rs.initiate()'

add the remaining two nodes to the set: 
mongo --eval "rs.add('$(hostname):27027');rs.add('$(hostname):27037')"
mongo --eval 'rs.status()'


### Commit and abort - Retry
def run_transaction_and_retry_commit(client):
  with client.start_session() as s:
          s.start_transaction()
          collection_one.insert_one(doc1, session=s)
          collection_two.insert_one(doc2, session=s)
          while True:
              try:
                  s.commit_transaction()
                  break
              except (OperationFailure, ConnectionFailure) as exc:
                  if exc.has_error_label("UnknownTransactionCommitResult"):
                      print("Unknown commit result, retrying...")
                      continue
                  raise

while True:
  try:
      return run_transaction_and_retry_commit(client)
  except (OperationFailure, ConnectionFailure) as exc:
      if exc.has_error_label("TransientTransactionError"):
          print("Transient transaction error, retrying...")
          continue
      raise
